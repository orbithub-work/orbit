# 智归档OS v1.0 产品规格文档

> 文档版本: v1.0  
> 更新日期: 2026-02-02  
> 适用场景: 产品开发、需求评审、功能测试

---

## 1. 产品定位

**智归档OS** 是一款面向独立创作者和小团队的媒体素材管理与轻量项目管理工具。

**核心设计理念**:
- **功能完整**: MVP即提供完整功能体验，不是功能阉割版
- **性能分层**: 免费版与Pro版的功能差异仅体现在性能限制（数量、频率、并发）
- **插件扩展**: Pro功能通过插件机制实现，保持核心简洁
- **本地优先**: 数据本地存储，无强制云端依赖

---

## 2. MVP v1.0 完整功能清单

### 2.1 工作区管理（Workspace）

#### 核心功能
- **单工作区架构**: 初始化并管理 `MediaAssistant/` 根目录
- **双区管理**:
  - `workspace/`: 热数据（活跃项目）
  - `archive/`: 冷数据（已归档项目）
  - `.cache/`: 隐藏缓存（缩略图、图标、临时文件）
- **桌面快捷方式**: 自动创建/重建工作区和归档区桌面快捷方式
- **目录保护**: 启动时逻辑锁定，删除前确认，关键目录隐藏

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 工作区数量 | 1个 | 无限制 |
| 监控目录深度 | 3级 | 无限制 |
| 文件监控并发 | 50个 | 无限制 |

---

### 2.2 文件管理（File Management）

#### 核心功能
- **文件扫描**: 递归扫描工作区，识别媒体文件（图片/视频/音频/文档）
- **实时索引**: 文件增删改实时更新数据库索引
- **多视图展示**:
  - 列表视图: 详细信息（名称、大小、类型、修改时间）
  - 网格视图: 缩略图预览
  - 树形视图: 目录层级结构
- **元数据提取**:
  - 图片: EXIF（尺寸、相机信息、拍摄时间）
  - 视频: 时长、分辨率、编码、帧率
  - 音频: ID3标签、时长、比特率
- **文件预览**: 内置图片/视频/音频预览器

#### 批量操作（核心）
- **批量复制/移动**: 支持跨目录拖拽操作
- **批量删除**: 可选择彻底删除或移至回收站
- **批量归档**: 选中文件一键归档至 `archive/`
- **批量重命名**（插件）: 模板引擎支持（日期、序号、前缀/后缀、正则替换）

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 索引文件数量 | 1000个 | 无限制 |
| 元数据提取并发 | 2个 | 无限制 |
| 批量操作并发 | 3个 | 无限制 |
| 历史记录保留 | 30天 | 无限制 |

---

### 2.3 版本快照系统（Version Snapshot）

#### 核心功能
- **自动全量备份**:
  - 按日/按时/按周配置备份频率
  - 支持定时备份（如每天凌晨2点）
  - 全量备份（完整文件复制，非增量）
- **手动备份**:
  - 支持手动创建关键版本备份
  - 可添加备份描述（如"最终交付版"）
- **备份管理**:
  - 时间线展示所有备份记录
  - 一键还原至任意备份版本
  - 还原前自动创建当前版本备份
- **备份策略**:
  - 保留策略配置（保留最近N个备份）
  - 存储空间自动清理

#### 存储结构
```
.cache/
├── backups/
│   └── {timestamp}/              # 时间戳命名备份目录
│       ├── workspace/            # 工作区完整备份
│       ├── archive/              # 归档区完整备份（可选）
│       └── manifest.json         # 备份清单（文件列表、总大小、创建时间）
```

#### 备份配置
```rust
struct BackupConfig {
    enabled: bool,                  // 是否启用自动备份
    schedule: BackupSchedule,       // 备份频率
    retention_count: u32,           // 保留备份数量
    include_archive: bool,          // 是否包含归档区
}

enum BackupSchedule {
    Hourly,                         // 每小时
    Daily { hour: u8, minute: u8 }, // 每日指定时间
    Weekly { day: WeekDay, hour: u8, minute: u8 }, // 每周指定时间
}
```

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 自动备份频率 | 每日1次 | 自定义（小时/日/周） |
| 备份保留数量 | 7个 | 无限制 |
| 手动备份次数 | 10次/月 | 无限制 |
| 备份存储空间 | 5GB | 无限制 |
| 并发备份任务 | 1个 | CPU核心数×2 |

---

### 2.4 安全归档引擎（Safe Archive）

#### 核心功能
- **归档流程**:
  1. 校验源文件存在性与可读性
  2. 创建目标目录结构（保持相对路径）
  3. 异步复制文件 + 进度显示
  4. SHA256哈希校验
  5. 校验成功后删除源文件（或保留标记）
  6. 记录归档日志
- **批量归档**: 队列化处理，失败自动重试（最多3次）
- **归档恢复**: 从归档区还原至原路径或指定路径
- **归档日志**: 完整记录（时间、路径、操作人、哈希值）

#### 归档目录组织
```
archive/
├── 2024/
│   ├── 01/           # 按年月归档
│   ├── 02/
│   └── ...
└── by-type/
    ├── images/
    ├── videos/       # 按类型归档
    └── audio/
```

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 单次归档文件数 | 50个 | 无限制 |
| 归档并发数 | 2个 | 无限制 |
| 归档日志保留 | 30天 | 无限制 |
| 自动归档规则 | 不支持 | 支持（30天未访问自动归档） |

---

### 2.5 集合管理（Collection）

#### 核心功能
- **创建集合**: 虚拟分类，不移动实际文件
- **添加文件**: 多对多关系，一个文件可属于多个集合
- **集合视图**: 独立于目录结构的分类浏览
- **封面设置**: 自定义集合封面
- **集合筛选**: 按类型、标签、时间筛选集合内文件
- **智能集合**（Pro）: 基于规则自动归集（如"所有4K视频"）

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 集合数量 | 10个 | 无限制 |
| 单集合文件数 | 100个 | 无限制 |
| 智能集合 | 不支持 | 支持 |

---

### 2.6 标签系统（Tag System）

#### 核心功能
- **标签管理**:
  - 创建/编辑/删除标签
  - 自定义标签颜色
  - 标签分类（如"状态"、"类型"、"优先级"）
- **文件打标签**: 多标签支持，批量添加/移除
- **标签筛选**: 单标签/多标签组合筛选
- **标签云**: 可视化展示标签使用频率
- **标签统计**: 显示每个标签的文件数量
- **自动标签建议**（Pro）: AI识别内容自动推荐标签

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 标签数量 | 20个 | 无限制 |
| 单文件标签数 | 5个 | 无限制 |
| 自动标签建议 | 不支持 | 支持 |
| 标签导入/导出 | 不支持 | 支持 |

---

### 2.7 搜索系统（Search）

#### 核心功能
- **关键词搜索**:
  - 文件名模糊匹配
  - 标签精确匹配
  - 元数据搜索（分辨率、时长等）
- **高级筛选**:
  - 文件类型（图片/视频/音频/文档）
  - 文件大小范围
  - 创建/修改时间范围
  - 是否已归档
- **搜索结果**:
  - 实时显示
  - 排序（相关性、时间、大小）
  - 批量操作（全选、标签、归档）
- **搜索历史**: 保存最近搜索记录
- **保存搜索**（Pro）: 保存常用搜索条件

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 搜索响应时间 | < 2秒 | < 500ms（内存索引加速） |
| 搜索结果数量 | 100条 | 无限制 |
| 保存搜索 | 不支持 | 支持 |
| 全文搜索（OCR） | 不支持 | 支持（图片内文字） |

---

### 2.8 轻量项目管理（Project Management）

#### 核心功能
- **项目识别**: 自动识别工作区中的项目目录
- **项目属性**:
  - 名称、路径
  - 截止日期（Deadline）
  - 状态（待处理/进行中/已完成）
  - 优先级（高/中/低）
- **项目统计**:
  - 文件数量
  - 总大小
  - 类型分布
  - 最后更新时间
- **项目看板**: 三列看板（待处理/进行中/已完成）
- **项目筛选**: 按状态、截止日期筛选
- **项目归档**: 完成后归档整个项目

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 项目数量 | 5个 | 无限制 |
| 截止日期提醒 | 不支持 | 支持（提前3天通知） |
| 项目模板 | 不支持 | 支持（创建项目时选择模板） |
| 项目导出报表 | 不支持 | 支持（PDF/Excel） |

---

### 2.9 项目动态图标（Dynamic Project Icon）

#### 核心功能
- **动态图标生成**:
  - 环形进度条显示剩余天数
  - 中心显示文件数量
  - 颜色随截止日期变化（绿/黄/红/灰）
- **Windows实现**:
  - 生成 `.ico` 图标文件
  - 创建 `desktop.ini` 关联图标
  - 调用 `SHChangeNotify` 刷新缓存
- **更新触发**:
  - 文件增删改（防抖5秒）
  - 截止日期变更（即时）
  - 每日凌晨刷新（天数变化）

#### 图标样式
```
环形倒计时样式:
╭────────╮
╱  12天  ╲    ← 剩余天数（环形进度）
│   📁    │
╲  156   ╱    ← 文件数量
 ╰────────╯

颜色规则:
- 绿色 (>7天): 时间充裕
- 黄色 (3-7天): 即将到期
- 红色 (<3天): 紧急
- 灰色 (已过期): 超期未处理
```

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 动态图标 | 仅文件数量 | 完整功能（含倒计时） |
| 图标刷新频率 | 手动刷新 | 自动实时刷新 |

---

### 2.10 操作日志与工作笔记（Activity Log）

#### 核心功能
- **系统静默记录**（自动追踪）:
  - 文件操作: 导入/删除/归档/恢复/移动
  - 项目操作: 创建/状态变更/截止日期变更/归档
  - 集合操作: 创建/文件添加或移除
  - 标签操作: 添加/移除
  - 元数据提取完成
  - 插件操作: 重命名/压缩/转换等批量操作
- **用户手动记录**:
  - 普通备注
  - 进度更新
  - 客户反馈
  - 待办事项
- **时间线视图**:
  - 按时间倒序排列
  - 按类型筛选（系统/用户）
  - 按项目/文件筛选
  - 搜索备注内容
- **资源管理器集成**:
  - 右键菜单快捷记录操作日志
  - 查看项目的完整操作历史
  - 支持从Windows资源管理器直接打开操作日志
- **富文本支持**:
  - Markdown基础语法
  - @提及文件/项目（自动链接）
  - #标签（笔记专用）
- **导出功能**: 导出为 Markdown/PDF

#### 数据结构
```rust
struct ActivityLog {
    id: UUID,
    timestamp: i64,
    entry_type: LogEntryType,  // 系统/用户
    actor: Actor,              // System / User
    target_type: TargetType,   // File/Project/Collection/Global
    target_id: String,
    title: String,
    content: Option<String>,   // Markdown
    metadata: HashMap<String, String>,
}
```

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 日志保留时间 | 30天 | 无限制 |
| 用户备注数量 | 50条/月 | 无限制 |
| 导出格式 | Markdown | Markdown + PDF |
| 高级筛选 | 基础 | 完整（多条件组合） |

---

### 2.11 缩略图与预览（Thumbnail & Preview）

#### 核心功能
- **缩略图生成**:
  - 图片: 直接生成
  - 视频: 首帧截图
  - 音频: 波形可视化
  - 文档: 首页预览
- **多尺寸缓存**:
  - Small: 128x128
  - Medium: 256x256
  - Large: 512x512
- **懒加载**: 滚动时动态加载
- **预生成**（Pro）: 后台预生成缩略图
- **格式支持**:
  - 图片: JPG/PNG/GIF/WebP/BMP/RAW
  - 视频: MP4/MOV/AVI/MKV/WEBM
  - 音频: MP3/WAV/FLAC/AAC/OGG

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 缩略图并发生成 | 2个 | 无限制 |
| 预生成 | 不支持 | 支持（扫描后后台生成） |
| 自定义缩略图 | 不支持 | 支持（选择视频任意帧） |

---

### 2.12 插件系统（Plugin System）

#### 核心设计
- **插件接口**: Go `interface` 定义
- **官方插件**: 所有插件由官方开发维护，不支持第三方插件安装
- **内置插件**（核心依赖）:
  - `ImagePlugin`: EXIF提取、图片缩略图生成
  - `VideoPlugin`: 视频元数据、帧截图
  - `AudioPlugin`: ID3标签、音频分析
- **扩展插件**（增值功能，随版本更新）:
  - **批量处理类**:
    - `BatchRenamePlugin`: 批量重命名
    - `BatchCompressPlugin`: 批量压缩
    - `BatchConvertPlugin`: 批量格式转换
    - `BatchWatermarkPlugin`: 批量水印
  - **AI增强类**:
    - `AutoTagPlugin`: AI自动标签（Pro）
    - `OcrPlugin`: 图片文字识别（Pro）
  - **工作流类**:
    - `SmartArchivePlugin`: 自动归档规则（Pro）
    - `CloudSyncPlugin`: 云盘同步（Pro）
    - `ReportPlugin`: 数据报表导出（Pro）

#### 插件管理
- 插件随应用版本更新，自动启用新插件
- 用户可在设置中查看已安装插件
- Pro插件需Pro授权才能使用

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 内置插件 | 全部 | 全部 |
| 批量处理插件 | 基础功能 | 完整功能 |
| AI增强插件 | 不支持 | 全部 |
| 工作流插件 | 不支持 | 全部 |

---

### 2.13 设置与配置（Settings）

#### 核心功能
- **通用设置**:
  - 语言（中文/English）
  - 主题（浅色/深色/跟随系统）
  - 启动行为（开机自启/最小化到托盘）
- **工作区设置**:
  - 根目录位置
  - 自动扫描频率
  - 快照保留策略
- **性能设置**:
  - 并发任务数
  - 内存使用上限
  - 低配机模式
- **快捷键**: 自定义键盘快捷键
- **备份与恢复**: 导出/导入完整配置

#### 版本差异
| 功能 | 免费版 | Pro版 |
|------|--------|-------|
| 配置备份 | 手动导出 | 自动云端备份 |
| 多设备同步 | 不支持 | 支持配置同步 |

---

## 3. 用户界面设计（UI/UX）

### 3.1 主界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  菜单栏  │  搜索栏                    │  设置 │  账户        │
├─────────┴────────────────────────────┴───────┴──────────────┤
│  侧边栏            │  主内容区域                              │
│  ├─ 工作区        │                                          │
│  ├─ 项目          │  ┌────────────────────────────────────┐  │
│  ├─ 集合          │  │  工具栏（视图切换/排序/筛选）       │  │
│  ├─ 标签          │  ├────────────────────────────────────┤  │
│  ├─ 归档区        │  │                                    │  │
│  ├─ 时间线        │  │  文件列表/网格/树形视图             │  │
│  └─ 设置          │  │                                    │  │
│                   │  └────────────────────────────────────┘  │
└───────────────────┴──────────────────────────────────────────┘
```

### 3.2 关键交互

- **右键菜单**: 文件/项目/集合的快捷操作
- **拖拽**: 文件移动、添加到集合
- **快捷键**: 
  - `Ctrl+F`: 搜索
  - `Ctrl+S`: 创建快照
  - `Delete`: 删除
  - `Ctrl+Shift+A`: 归档
- **通知**: 归档完成、快照生成、截止日期提醒

---

## 4. 技术规格摘要

### 4.1 技术栈

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| 桌面框架 | Electron | UI 外壳，支持原生拖拽与系统能力 |
| 前端 | Vue 3 + TypeScript | 响应式、组件化 |
| UI组件 | Element Plus | 成熟稳定 |
| 后端 | Go 1.22+ | 高并发性能、简单易用 |
| 异步运行时 | Goroutines | 原生支持、高性能并发 |
| 数据存储 | SQLite | 结构化查询、零依赖 |
| 文件监控 | fsnotify | 跨平台文件系统事件 |

### 4.2 性能指标

| 指标 | 目标值 |
|------|--------|
| 启动时间 | ≤ 3秒 |
| 内存占用 | ≤ 50MB（空闲） |
| 文件扫描速度 | ≥ 1000文件/秒 |
| 搜索响应 | ≤ 500ms（Pro）/ ≤ 2秒（免费） |
| 缩略图生成 | ≤ 200ms（128x128） |

### 4.3 存储要求

| 数据类型 | 存储位置 | 格式 |
|---------|---------|------|
| 配置 | `~/.config/media-assistant/` | JSON |
| 数据库 | `~/.local/share/media-assistant/` | SQLite |
| 缩略图 | `.cache/thumbnails/` | JPG |
| 快照 | `.cache/snapshots/` | BIN + JSON |
| 日志 | `.cache/logs/` | 文本/JSON |

---

## 5. 版本授权与定价

### 5.1 版本对比

| 维度 | 免费版 | Pro版（199元永久） |
|------|--------|-------------------|
| **价格** | ¥0 | ¥199（一次性） |
| **工作区** | 1个 | 无限制 |
| **文件索引** | 1000个 | 无限制 |
| **快照保留** | 7天自动 / 10次手动 | 无限制 |
| **归档** | 基础功能 | 自动归档规则 |
| **插件** | 内置插件 | 内置 + 扩展插件 |
| **性能** | 基础并发 | 高并发优化 |
| **导出** | Markdown | Markdown + PDF |

### 5.2 授权机制

- **本地授权**: 机器码 + AES-256加密，离线验证
- **机器码生成**: 主板UUID + CPU序列号 + 硬盘序列号哈希
- **授权文件**: `license.lic`（加密存储权限信息）
- **多设备**: Pro版支持3台设备同时激活

---

## 6. 附录

### 6.1 文件类型支持

| 类型 | 扩展名 |
|------|--------|
| 图片 | jpg, jpeg, png, gif, webp, bmp, tiff, raw, heic |
| 视频 | mp4, mov, avi, mkv, webm, flv, wmv, m4v |
| 音频 | mp3, wav, flac, aac, ogg, m4a, wma |
| 文档 | pdf, doc, docx, txt, xls, xlsx, ppt, pptx |

### 6.2 快捷键列表

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+F` | 搜索 |
| `Ctrl+Shift+F` | 高级搜索 |
| `Ctrl+S` | 创建快照 |
| `Ctrl+Z` | 撤销 |
| `Delete` | 删除（确认） |
| `Ctrl+Shift+A` | 归档 |
| `Ctrl+N` | 新建集合 |
| `Ctrl+T` | 添加标签 |
| `F5` | 刷新 |
| `Ctrl+,` | 设置 |

### 6.3 术语表

| 术语 | 说明 |
|------|------|
| 工作区 | 用户创作的根目录，包含活跃项目 |
| 归档区 | 已完成的冷数据存储区 |
| 集合 | 虚拟分类，不移动实际文件 |
| 快照 | 文件某一时刻的完整备份 |
| 项目 | 工作区中的一个独立创作单元 |
| 动态图标 | 显示项目统计信息的文件夹图标 |

---

**文档结束**
