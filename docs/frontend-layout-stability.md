# 前端布局稳定性优化

## 🎯 问题

之前的实现存在以下问题：
1. 数据为空时，组件完全不显示，导致布局变形
2. 首次加载时没有骨架屏，界面闪烁
3. 接口失败时，整个区域塌陷
4. 条件渲染过多，布局不稳定

## ✅ 解决方案

### 1. 骨架屏加载状态

**SkeletonGrid 组件**
- 首次加载时显示骨架屏
- 保持布局结构不变
- 流畅的加载动画

```vue
<!-- 首次加载 -->
<SkeletonGrid 
  v-if="loading && displayItems.length === 0"
  :count="12"
  :item-size="zoomLevel"
/>

<!-- 加载完成 -->
<VirtualAssetGrid v-else ... />
```

### 2. 空状态占位

**始终保持布局结构**
```vue
<!-- ❌ 错误：完全不显示 -->
<div v-if="items.length > 0">
  <Item v-for="item in items" />
</div>

<!-- ✅ 正确：显示空状态 -->
<div class="content">
  <EmptyState v-if="items.length === 0" />
  <Item v-for="item in items" />
</div>
```

### 3. 最小高度保证

**CSS 确保布局稳定**
```css
.group-content {
  flex: 1;
  overflow-y: auto;
  min-height: 60px;  /* 即使为空也保持高度 */
  padding-bottom: 12px;
}

.empty-hint {
  min-height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}
```

### 4. 默认值显示

**状态栏始终显示基础信息**
```vue
<!-- ❌ 错误：条件显示 -->
<span v-if="projectName">{{ projectName }}</span>

<!-- ✅ 正确：显示默认值 -->
<span>{{ projectName || '未选择项目' }}</span>
<span>{{ totalAssets }} 项</span>  <!-- 0 也显示 -->
```

## 📋 修改清单

### 组件级别

**1. PoolView.vue**
- ✅ 添加骨架屏（首次加载）
- ✅ 区分首次加载和加载更多
- ✅ 空状态不影响布局

**2. PoolSidebar.vue**
- ✅ 标签空状态包裹在容器中
- ✅ 添加 min-height 保证
- ✅ empty-hint 样式

**3. ProjectSidebar.vue**
- ✅ 项目列表空状态优化
- ✅ 添加 min-height 保证
- ✅ empty-hint 样式

**4. StatusBar.vue**
- ✅ 始终显示项目名称（默认值）
- ✅ 始终显示素材数量（0 也显示）
- ✅ 布局不因数据变化而跳动

**5. SkeletonGrid.vue（新增）**
- ✅ 通用骨架屏组件
- ✅ 可配置数量和尺寸
- ✅ 流畅的加载动画

## 🎨 视觉效果

### 加载流程
```
1. 首次进入
   ┌─────────────────┐
   │ 🔲 🔲 🔲 🔲    │  骨架屏
   │ 🔲 🔲 🔲 🔲    │  (shimmer 动画)
   └─────────────────┘

2. 加载完成（有数据）
   ┌─────────────────┐
   │ 📷 📷 📷 📷    │  正常显示
   │ 📷 📷 📷 📷    │
   └─────────────────┘

3. 加载完成（无数据）
   ┌─────────────────┐
   │                 │
   │   📂 暂无素材   │  空状态提示
   │                 │
   └─────────────────┘
```

### 侧边栏
```
┌──────────────┐
│ 📁 项目列表  │
├──────────────┤
│              │
│ 📁 暂无项目  │  空状态（保持高度）
│              │
├──────────────┤
│ 🏷️ 标签     │
├──────────────┤
│              │
│ 🏷️ 暂无标签 │  空状态（保持高度）
│              │
└──────────────┘
```

## 🔧 最佳实践

### 1. 三态设计
- **加载中**：骨架屏
- **有数据**：正常显示
- **无数据**：空状态提示

### 2. 布局稳定
- 使用 min-height 保证最小高度
- 空状态占据相同空间
- 避免条件渲染导致布局跳动

### 3. 用户体验
- 首次加载显示骨架屏
- 加载更多显示 loading 指示器
- 空状态提供友好提示

### 4. 默认值
- 文本显示默认值而非隐藏
- 数字显示 0 而非隐藏
- 保持 UI 一致性

## 📊 对比

| 场景 | 优化前 | 优化后 |
|------|--------|--------|
| 首次加载 | 空白闪烁 | 骨架屏动画 |
| 无数据 | 区域塌陷 | 空状态占位 |
| 接口失败 | 布局变形 | 保持结构 |
| 状态栏 | 信息缺失 | 显示默认值 |

## 🚀 效果

- ✅ 布局始终稳定，不会变形
- ✅ 加载过程流畅，无闪烁
- ✅ 空状态友好，有提示
- ✅ 接口失败不影响布局
- ✅ 用户体验更好
